# åˆ†å¸ƒå¼æ¨ç†å¼•æ“è‡ªåŠ¨åŒ–æµ‹è¯•Playbook

è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ä¸ºåˆ†å¸ƒå¼æ¨ç†å¼•æ“è®¾è®¡çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç³»ç»Ÿï¼Œèƒ½å¤Ÿåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸ŠæŒ‰é¡ºåºæ‰§è¡Œä¸åŒçš„æµ‹è¯•åœºæ™¯ï¼Œæ”¶é›†æ€§èƒ½æ•°æ®ï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

- **åˆ†å¸ƒå¼èŠ‚ç‚¹ç®¡ç†**: é€šè¿‡SSHç®¡ç†å¤šä¸ªæµ‹è¯•èŠ‚ç‚¹ï¼Œæ”¯æŒè¿æ¥æ± å’Œè‡ªåŠ¨é‡è¿
- **åœºæ™¯åŒ–æµ‹è¯•**: æ”¯æŒå®Œå…¨å¯é…ç½®çš„æµ‹è¯•åœºæ™¯å’Œæ‰§è¡Œé¡ºåºï¼Œä¸‰ç§æ‰§è¡Œæ¨¡å¼
- **DockeræœåŠ¡ç®¡ç†**: è¿œç¨‹ç®¡ç†æ¨ç†æœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢ï¼Œæ”¯æŒDocker Composeç‰ˆæœ¬è‡ªé€‚åº”
- **åŸºå‡†æµ‹è¯•æ‰§è¡Œ**: é›†æˆAICPåŸºå‡†æµ‹è¯•ï¼Œæ”¯æŒå¤šç§æµ‹è¯•é…ç½®å’Œå¹¶è¡Œæ‰§è¡Œ
- **ç»“æœè‡ªåŠ¨æ”¶é›†**: ä»å„èŠ‚ç‚¹æ”¶é›†æµ‹è¯•æ•°æ®å¹¶æŒ‰åœºæ™¯å½’æ¡£ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼
- **å¥åº·çŠ¶æ€ç›‘æ§**: å…¨é¢çš„ç³»ç»Ÿå¥åº·æ£€æŸ¥å’Œå®¹é”™æœºåˆ¶ï¼Œæ”¯æŒè‡ªåŠ¨æ¢å¤
- **ä¸°å¯Œçš„CLIå·¥å…·**: å‘½ä»¤è¡Œç•Œé¢æ–¹ä¾¿æ“ä½œå’Œç›‘æ§ï¼Œæ”¯æŒè¯¦ç»†æ¨¡å¼å’Œå¹²è¿è¡Œ
- **æ™ºèƒ½ç‰ˆæœ¬é€‚é…**: è‡ªåŠ¨æ£€æµ‹Docker Composeç‰ˆæœ¬(V1/V2)å¹¶é€‚é…ç›¸åº”å‘½ä»¤
- **å¼ºåŒ–é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§

## ğŸ“ é¡¹ç›®ç»“æ„

```
test_playbook/
â”œâ”€â”€ playbook.py              # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶ï¼ˆå®é™…ä½¿ç”¨çš„é…ç½®ï¼Œä¸æäº¤åˆ°gitï¼‰
â”‚   â”œâ”€â”€ nodes.yaml          # èŠ‚ç‚¹é…ç½®ï¼ˆä»æ¨¡æ¿å¤åˆ¶å¹¶è‡ªå®šä¹‰ï¼‰
â”‚   â”œâ”€â”€ scenarios.yaml      # åœºæ™¯é…ç½®ï¼ˆä»æ¨¡æ¿å¤åˆ¶å¹¶è‡ªå®šä¹‰ï¼‰
â”‚   â””â”€â”€ scenarios/          # æµ‹è¯•åœºæ™¯ç›®å½•
â”‚       â”œâ”€â”€ 001_baseline/   # åŸºçº¿æµ‹è¯•åœºæ™¯
â”‚       â”œâ”€â”€ 002_memory_opt/ # å†…å­˜ä¼˜åŒ–åœºæ™¯
â”‚       â””â”€â”€ ...             # æ›´å¤šåœºæ™¯
â”œâ”€â”€ templates/               # é…ç½®æ¨¡æ¿å’Œç¤ºä¾‹
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ nodes.yaml      # è„±æ•çš„èŠ‚ç‚¹é…ç½®æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ scenarios.yaml  # è„±æ•çš„åœºæ™¯é…ç½®æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ scenarios/      # åœºæ™¯æ¨¡æ¿ç›®å½•
â”‚   â””â”€â”€ README.md           # æ¨¡æ¿ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ src/                     # æºä»£ç 
â”‚   â”œâ”€â”€ playbook/           # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ core.py         # æ ¸å¿ƒæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ node_manager.py # èŠ‚ç‚¹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ scenario_*.py   # åœºæ™¯ç®¡ç†å’Œæ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ docker_*.py     # DockeræœåŠ¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ benchmark_runner.py # åŸºå‡†æµ‹è¯•æ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ result_collector.py # ç»“æœæ”¶é›†
â”‚   â”‚   â””â”€â”€ health_checker.py   # å¥åº·æ£€æŸ¥
â”‚   â””â”€â”€ utils/              # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ ssh_client.py   # SSHè¿æ¥å·¥å…·
â”‚       â”œâ”€â”€ config_loader.py # é…ç½®åŠ è½½å™¨
â”‚       â”œâ”€â”€ logger.py       # æ—¥å¿—å·¥å…·
â”‚       â””â”€â”€ docker_compose_adapter.py # Docker Composeç‰ˆæœ¬é€‚é…
â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ results/                # æµ‹è¯•ç»“æœ
```

## ğŸ”§ å®‰è£…å’Œé…ç½®

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®æ–‡ä»¶è®¾ç½®

**é‡è¦æç¤º**: `config/` ç›®å½•ä¸­çš„æ–‡ä»¶ä¸ä¼šæäº¤åˆ°gitä»“åº“ï¼Œè¿™äº›æ˜¯æ‚¨çš„å®é™…é…ç½®æ–‡ä»¶ã€‚

#### åˆå§‹åŒ–é…ç½®æ–‡ä»¶

ä»æ¨¡æ¿å¤åˆ¶é…ç½®æ–‡ä»¶ï¼š

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp -r templates/config/* config/

# æˆ–è€…å•ç‹¬å¤åˆ¶éœ€è¦çš„æ–‡ä»¶
cp templates/config/nodes.yaml config/
cp templates/config/scenarios.yaml config/
cp -r templates/config/scenarios config/
```

#### é…ç½®èŠ‚ç‚¹ä¿¡æ¯

ç¼–è¾‘ `config/nodes.yaml`ï¼Œæ›¿æ¢ä¸ºæ‚¨çš„å®é™…é…ç½®ï¼š

```yaml
nodes:
  node1:
    host: "YOUR_ACTUAL_IP"              # æ›¿æ¢ä¸ºå®é™…IPåœ°å€
    username: "root"                    # æ›¿æ¢ä¸ºå®é™…ç”¨æˆ·å
    password: "${NODE1_PASSWORD}"       # è®¾ç½®ç¯å¢ƒå˜é‡
    enabled: true
    docker_compose_path: "/opt/inference"
    results_path: "/opt/benchmark/results"
```

#### é…ç½®åœºæ™¯æ‰§è¡Œ

ç¼–è¾‘ `config/scenarios.yaml`ï¼š

```yaml
execution:
  scenarios_root: "config/scenarios"   # åœºæ™¯æ ¹ç›®å½•
  execution_mode: "custom"
  custom_order:
    - name: "baseline_test"
      directory: "001_baseline"
      enabled: true
      description: "åŸºçº¿æ€§èƒ½æµ‹è¯•"
```

### 3. è®¾ç½®ç¯å¢ƒå˜é‡

```bash
export NODE1_PASSWORD="your_actual_password"
export NODE2_PASSWORD="your_actual_password"
export NODE3_PASSWORD="your_actual_password"
```

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€

```bash
./playbook.py status
```

### åˆ—å‡ºæ‰€æœ‰åœºæ™¯

```bash
./playbook.py scenarios
```

### åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹

```bash
./playbook.py nodes
```

### è¿è¡Œå¥åº·æ£€æŸ¥

```bash
./playbook.py health
```

### è¿è¡Œå•ä¸ªåœºæ™¯

```bash
./playbook.py run baseline_test
```

### è¿è¡Œæ‰€æœ‰åœºæ™¯

```bash
./playbook.py run --all
```

### éªŒè¯é…ç½®

```bash
./playbook.py validate
```

### åœºæ™¯ç®¡ç†

```bash
# å¯ç”¨åœºæ™¯
./playbook.py scenario baseline_test --enable

# ç¦ç”¨åœºæ™¯
./playbook.py scenario baseline_test --disable

# æŸ¥çœ‹åœºæ™¯è¯¦æƒ…
./playbook.py scenario baseline_test
```

### æŸ¥çœ‹æµ‹è¯•ç»“æœ

```bash
./playbook.py results
```

## ğŸ“ åœºæ™¯é…ç½®

æ¯ä¸ªæµ‹è¯•åœºæ™¯åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

### metadata.yaml - åœºæ™¯å…ƒæ•°æ®
```yaml
name: "baseline_test"
description: "åŸºçº¿æ€§èƒ½æµ‹è¯•"
estimated_duration: 1800
tags: ["performance", "baseline"]
resource_requirements:
  min_gpu_memory: "24GB"
  min_nodes: 2
```

### docker-compose.yml - æœåŠ¡é…ç½®
```yaml
services:
  p-1:
    image: "inference-engine:latest"
    ports:
      - "18008:8000"
  d-1:
    image: "data-processor:latest"
    ports:
      - "18009:8001"
```

### test_config.json - æµ‹è¯•å‚æ•°
```json
{
  "base_url": "http://10.112.0.201:18008",
  "model": "/data/Qwen3-235B-A22B",
  "num_prompts": 1000,
  "max_concurrency": 20,
  "metadata": {
    "scenario": "baseline_test",
    "gpu_num": 4
  }
}
```

## ğŸ“Š æµ‹è¯•ç»“æœ

æµ‹è¯•å®Œæˆåï¼Œç»“æœä¼šæŒ‰ç…§æ—¥æœŸå’Œåœºæ™¯è¿›è¡Œç»„ç»‡ï¼š

```
results/
â”œâ”€â”€ 20240906_143022/
â”‚   â”œâ”€â”€ baseline_test/
â”‚   â”‚   â”œâ”€â”€ node1/
â”‚   â”‚   â”œâ”€â”€ node2/
â”‚   â”‚   â”œâ”€â”€ test_metadata.json
â”‚   â”‚   â”œâ”€â”€ result_summary.json
â”‚   â”‚   â”œâ”€â”€ performance_results.csv
â”‚   â”‚   â””â”€â”€ test_report.md
```

æ¯ä¸ªåœºæ™¯çš„ç»“æœåŒ…å«ï¼š
- åŸå§‹æµ‹è¯•æ•°æ®æ–‡ä»¶
- æ€§èƒ½æŒ‡æ ‡æ±‡æ€» 
- æµ‹è¯•å…ƒæ•°æ®
- CSVæ ¼å¼çš„æ€§èƒ½æ•°æ®
- Markdownæµ‹è¯•æŠ¥å‘Š

## ğŸ”„ æ‰§è¡Œæµç¨‹

1. **ç³»ç»Ÿå¥åº·æ£€æŸ¥**: éªŒè¯æ‰€æœ‰èŠ‚ç‚¹å’ŒæœåŠ¡çŠ¶æ€
2. **ç¯å¢ƒå‡†å¤‡**: ä¸Šä¼ é…ç½®æ–‡ä»¶ï¼Œå‡†å¤‡æµ‹è¯•ç¯å¢ƒ
3. **æœåŠ¡å¯åŠ¨**: åœ¨å„èŠ‚ç‚¹å¯åŠ¨æ¨ç†æœåŠ¡
4. **ç­‰å¾…å°±ç»ª**: ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨å’Œå¥åº·æ£€æŸ¥é€šè¿‡
5. **æ‰§è¡Œæµ‹è¯•**: è¿è¡ŒAICPåŸºå‡†æµ‹è¯•
6. **æ”¶é›†ç»“æœ**: ä»å„èŠ‚ç‚¹ä¸‹è½½æµ‹è¯•ç»“æœ
7. **æœåŠ¡åœæ­¢**: åœæ­¢æ¨ç†æœåŠ¡
8. **ç¯å¢ƒæ¸…ç†**: æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œèµ„æº
9. **ç”ŸæˆæŠ¥å‘Š**: æ±‡æ€»æ•°æ®å¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### åœºæ™¯ç®¡ç†æ¨¡å¼

æ”¯æŒä¸‰ç§åœºæ™¯å‘ç°æ¨¡å¼ï¼š
- **auto**: è‡ªåŠ¨å‘ç°å¹¶æŒ‰ç›®å½•åæ’åº
- **directory**: ä¸¥æ ¼æŒ‰ç›®å½•åæ’åºæ‰§è¡Œ  
- **custom**: å®Œå…¨è‡ªå®šä¹‰æ‰§è¡Œé¡ºåº

### è¿‡æ»¤å’Œæ¡ä»¶æ‰§è¡Œ

```yaml
filters:
  include_tags: ["performance"]
  exclude_tags: ["experimental"]
  only_scenarios: ["baseline_test"]
  skip_scenarios: ["large_model_test"]
```

### å®¹é”™å’Œé‡è¯•

```yaml
inter_scenario:
  wait_between_scenarios: 120
  continue_on_failure: true
  retry_count: 1
```

### Docker Composeç‰ˆæœ¬è‡ªé€‚åº”

ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹èŠ‚ç‚¹ä¸Šçš„Docker Composeç‰ˆæœ¬(V1æˆ–V2)å¹¶é€‚é…ç›¸åº”çš„å‘½ä»¤æ ¼å¼ï¼š
```bash
# è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ç›¸åº”ç‰ˆæœ¬
# V1: docker-compose -f file.yml up -d
# V2: docker compose -f file.yml up -d
```

### å¹¶è¡Œæ‰§è¡Œå’Œæ€§èƒ½ä¼˜åŒ–

- **è¿æ¥æ± ç®¡ç†**: æ™ºèƒ½SSHè¿æ¥å¤ç”¨ï¼Œå‡å°‘è¿æ¥å¼€é”€
- **å¹¶è¡Œå¥åº·æ£€æŸ¥**: åŒæ—¶æ£€æŸ¥å¤šä¸ªèŠ‚ç‚¹çŠ¶æ€
- **æ™ºèƒ½é‡è¯•**: åŸºäºé”™è¯¯ç±»å‹çš„å·®å¼‚åŒ–é‡è¯•ç­–ç•¥
- **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜ç‰ˆæœ¬æ£€æµ‹å’Œé…ç½®éªŒè¯ç»“æœ

### è‡ªåŠ¨æ¢å¤

å¥åº·æ£€æŸ¥å™¨æ”¯æŒè‡ªåŠ¨æ¢å¤æœºåˆ¶ï¼Œå¯ä»¥åœ¨æ£€æµ‹åˆ°é—®é¢˜æ—¶è‡ªåŠ¨å°è¯•ä¿®å¤ï¼š
- DockeræœåŠ¡è‡ªåŠ¨é‡å¯
- SSHè¿æ¥è‡ªåŠ¨é‡è¿
- å¤±è´¥èŠ‚ç‚¹çš„éš”ç¦»å’Œæ¢å¤

## ğŸ“‹ æœ€ä½³å®è·µ

1. **åœºæ™¯å‘½å**: ä½¿ç”¨æ•°å­—å‰ç¼€æ§åˆ¶æ‰§è¡Œé¡ºåºï¼ˆå¦‚ `001_baseline`ï¼‰
2. **é…ç½®ç®¡ç†**: ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
3. **èµ„æºè§„åˆ’**: åœ¨metadata.yamlä¸­æ˜ç¡®èµ„æºéœ€æ±‚
4. **é”™è¯¯å¤„ç†**: å¯ç”¨continue_on_failureè¿›è¡Œæ‰¹é‡æµ‹è¯•
5. **ç»“æœç®¡ç†**: å®šæœŸæ¸…ç†æ—§çš„æµ‹è¯•ç»“æœï¼Œé¿å…ç£ç›˜ç©ºé—´ä¸è¶³
6. **ç›‘æ§æ—¥å¿—**: ä½¿ç”¨è¯¦ç»†æ—¥å¿—æ¨¡å¼è¿›è¡Œé—®é¢˜æ’æŸ¥

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **SSHè¿æ¥å¤±è´¥**: æ£€æŸ¥èŠ‚ç‚¹é…ç½®å’Œç½‘ç»œè¿é€šæ€§
2. **DockeræœåŠ¡å¯åŠ¨å¤±è´¥**: éªŒè¯docker-composeæ–‡ä»¶å’Œé•œåƒ
3. **æµ‹è¯•æ‰§è¡Œè¶…æ—¶**: è°ƒæ•´è¶…æ—¶é…ç½®æˆ–æ£€æŸ¥èµ„æºä½¿ç”¨æƒ…å†µ
4. **ç»“æœæ”¶é›†å¤±è´¥**: æ£€æŸ¥ç»“æœè·¯å¾„å’Œæƒé™è®¾ç½®

### è°ƒè¯•å‘½ä»¤

```bash
# è¯¦ç»†æ¨¡å¼è¿è¡Œ
./playbook.py --verbose --log-level DEBUG status

# éªŒè¯é…ç½®
./playbook.py validate

# å¥åº·æ£€æŸ¥
./playbook.py health

# å¹²è¿è¡Œ - éªŒè¯é…ç½®ä½†ä¸æ‰§è¡Œ
./playbook.py run --dry-run

# è¿è¡Œå•ä¸ªåœºæ™¯å¹¶è¯¦ç»†è¾“å‡º
./playbook.py --verbose run baseline_test

# æŸ¥çœ‹ç»“æœçš„ä¸åŒæ ¼å¼
./playbook.py results --format json
./playbook.py results --format yaml
./playbook.py results --format table
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¹¶å‘æ§åˆ¶**: æ ¹æ®ç¡¬ä»¶èµ„æºè°ƒæ•´max_concurrency
2. **æ‰¹å¤„ç†**: ä½¿ç”¨åˆé€‚çš„batch_sizeæé«˜ååé‡
3. **å†…å­˜ç®¡ç†**: ç›‘æ§GPUå’Œç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ
4. **ç½‘ç»œä¼˜åŒ–**: ç¡®ä¿èŠ‚ç‚¹é—´ç½‘ç»œå¸¦å®½å……è¶³
5. **å­˜å‚¨IO**: ä½¿ç”¨é«˜æ€§èƒ½å­˜å‚¨å­˜æ”¾æ¨¡å‹å’Œç»“æœæ•°æ®

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹ [FAQ](docs/FAQ.md)
2. æœç´¢å·²æœ‰çš„ [Issues](https://github.com/your-org/test_playbook/issues)
3. åˆ›å»ºæ–°çš„ Issue æè¿°æ‚¨çš„é—®é¢˜
4. è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒ

---

ğŸš€ **Happy Testing!** ğŸš€